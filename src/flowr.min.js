/*! flowr 18-09-2013 */
!function(a,b,c){function d(a,b,c){if(null!=a)if(m&&a.forEach===m)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===k)return}else for(var f=_.keys(a),d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===k)return}function e(a,b,c,e){var f=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return e&&(b=_.bind(b,e)),f?a.reduce(b,c):a.reduce(b);if(d(a,function(a,d,g){f?c=b.call(e,c,a,d,g):(c=a,f=!0)}),!f)throw new TypeError("Reduce of empty array with no initial value");return c}function f(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}}function g(a){this.src_=a.src,this.width_=a.width,this.height_=a.height,this.originalWidth_=a.width,this.originalHeight_=a.height,this.ratio_=this.originalWidth_/this.originalHeight_,this.element_=c(this.html()).get(0)}function h(a){var b;return"object"==typeof a&&a.url&&a.size&&a.size.w&&a.size.h&&(b=new g({src:a.url,width:a.size.w,height:a.size.h})),b||!1}function i(a){this.storage_=[],this.width_=a.width}function j(a,b){var d,g=this,i=this.flowers=c.map(b.data,function(a){return h(a)}),j=c("#imageContainer").width(),k=c("<div class='elements-wrapper'></div>");this.options=b,this.calculateRows(j),d=e(i,function(a,b){return a.push(b.element()),a},[]),k.css("width",j),k.append(d),a.append(k),c(window).resize(f(function(){var b=a.width();k.css("width",b),g.calculateRows(b)},300))}var k={},l=Array.prototype,m=l.forEach,n=l.reduce;g.prototype={constructor:g,html:function(){return["<div class='flowr-item' style='width: ",this.width(),"px; height: ",this.height(),"px;'>","<img class='flowr-inner' src='",this.src(),"'>","</div>"].join("")},src:function(a){return a&&a>0?(this.src_=a,this):this.src_},width:function(a,b){return a&&a>0?(this.width_=a,b&&b&&b.relative===!1||(this.height_=Math.floor(a/this.ratio_)),b&&b&&b.updateHtml===!1||this.updateHtml_(),this):this.width_},height:function(a,b){return a&&a>0?(this.height_=a,b&&b&&b.relative===!1||(this.width_=Math.floor(a*this.ratio_)),b&&b&&b.updateHtml===!1||this.updateHtml_(),this):this.height_},element:function(){return this.element_},updateHtml_:function(){c(this.element_).css({width:this.width_,height:this.height_})},update:function(){return this.updateHtml_(),this}},i.prototype={constructor:i,addFlower:function(a){return this.flowersWidth()+a.width()<=this.width()?(this.storage_.push(a),!0):!1},flowersWidth:function(){return e(this.storage_,function(a,b){return a+b.width()},0)},width:function(){return this.width_},fitWidth:function(){var a=this.width()/this.flowersWidth(),b=Math.floor(this.storage_[0].height()*a);d(this.storage_,function(a){a.height(b,{updateHtml:!1})}),this.width()-this.flowersWidth()<5&&this.storage_[0].width(this.storage_[0].width()+(this.width()-this.flowersWidth()),{relative:!1,updateHtml:!1})}},j.prototype.calculateRows=function(a){var b,c=[],e=this.flowers,f=this.options;b=new i({width:a}),d(e,function(d){d.height(f.minHeight),b.addFlower(d)||(b.fitWidth(),c.push(b),b=new i({width:a}),b.addFlower(d))}),d(e,function(a){a.update()})},c.fn.flowr=function(a){return this.each(function(){var b=c(this),d=c(this).data(),e=d.flowr;e?e.setOptions(a):new j(b,c.extend({},{},a))})}}(window,document,jQuery);